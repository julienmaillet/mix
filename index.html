<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Circle song #1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    background: linear-gradient(135deg,#fff,#ddd);
    color: #222; /* texte sombre sur fond clair */
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 20px;
  }
  h1 {
    color: #0a3d62; /* bleu foncé */
    text-shadow: 0 0 5px #0a3d62, 0 0 10px #74b9ff;
  }
  #status {
    margin: 15px 0;
    font-size: 1.1em;
    color: #555;
  }
  .circle-container {
    position: relative;
    width: 300px;
    height: 300px;
    margin: 40px auto;
  }
  .box {
    position: absolute;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    background: #74b9ff; /* couleur inactive bleu clair */
    color: #fff;
    font-weight: bold;
    transition: transform 0.1s, background 0.2s;
    user-select: none;
  }
  .box:hover { transform: scale(1.05); }
  .box.active {
    background: #0984e3; /* couleur active bleu foncé */
    color: #fff;
    animation: pulse 0.5s infinite;
  }
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }
  @media (max-width: 500px) {
    .circle-container { width: 220px; height: 220px; }
    .box { width: 60px; height: 60px; font-size: 0.9em; }
  }
</style>
</head>
<body>
<h1>Circle song #1</h1>
<div id="status">Chargement des pistes…</div>
<div class="circle-container" id="grid"></div>

<script>
const trackFiles = ["voix1.wav","voix2.wav","voix3.wav","voix4.wav","voix5.wav","voix6.wav"];
let audioCtx, buffers=[], sources=[], gains=[], isPlaying=false;

const grid = document.getElementById("grid");
const statusEl = document.getElementById("status");

// Création des cases Voix 1 à 6
trackFiles.forEach((f,i)=>{
  const box=document.createElement("div");
  box.className="box";
  box.textContent="Voix "+(i+1);
  box.dataset.idx=i;
  grid.appendChild(box);
});

// Position circulaire
function positionBoxes(){
  const boxes = document.querySelectorAll(".box");
  const radius = 120;
  boxes.forEach((box,i)=>{
    const angle = (i/boxes.length)*2*Math.PI - Math.PI/2; // commencer en haut
    const x = radius * Math.cos(angle);
    const y = radius * Math.sin(angle);
    box.style.left = `calc(50% + ${x}px - 40px)`; // 40px = la moitié de la largeur
    box.style.top  = `calc(50% + ${y}px - 40px)`;
  });
}
positionBoxes();

// Précharger fichiers WAV
async function loadAll(){
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  for(let i=0;i<trackFiles.length;i++){
    const resp = await fetch(trackFiles[i]);
    const ab = await resp.arrayBuffer();
    buffers[i] = await audioCtx.decodeAudioData(ab);
  }
  statusEl.textContent = "Clique sur une voix pour lancer le playback.";
}
loadAll();

// Démarrer toutes les pistes synchronisées
function startAll(){
  const startTime = audioCtx.currentTime + 0.05;
  sources = [];
  gains = [];
  buffers.forEach((buf,i)=>{
    const src = audioCtx.createBufferSource();
    src.buffer = buf;
    src.loop = true;
    const gainNode = audioCtx.createGain();
    gainNode.gain.value = 0;
    src.connect(gainNode).connect(audioCtx.destination);
    src.start(startTime);
    sources[i]=src;
    gains[i]=gainNode;
  });
  isPlaying=true;
  statusEl.textContent = "Lecture en cours : active/désactive les voix.";
}

// Gestion des clics
grid.addEventListener("click", async (e)=>{
  if(!e.target.classList.contains("box")) return;
  const idx = e.target.dataset.idx;

  // Démarrage au premier clic
  if(!isPlaying){
    if(audioCtx.state==="suspended") await audioCtx.resume();
    startAll();
  }

  // Toggle voix
  const gainNode = gains[idx];
  if(e.target.classList.contains("active")){
    e.target.classList.remove("active");
    gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
  } else {
    e.target.classList.add("active");
    gainNode.gain.setValueAtTime(1, audioCtx.currentTime);
  }
});
</script>
</body>
</html>
